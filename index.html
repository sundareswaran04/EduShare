<html lang="en">

<head>
  <meta charset="utf-8" />
  <meta content="width=device-width, initial-scale=1.0" name="viewport" />
  <title>
    Edushare - Study Sharing Platform
  </title>
  <link href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css" rel="stylesheet" />
  <script src="https://code.jquery.com/jquery-3.5.1.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.9.2/dist/umd/popper.min.js"></script>
  <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>
  <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/all.min.css" rel="stylesheet" />
  <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;700&amp;display=swap" rel="stylesheet" />
  <link href="styles.css" rel="stylesheet" />
  <script src="scripts.js"></script>
</head>

<body class="font-roboto bg-light">
  <header class="bg-primary text-white p-4">
    <div class="container d-flex justify-content-between align-items-center">
      <h1 class="h2 font-weight-bold">
        Edushare
      </h1>
      <nav>
        <ul class="nav">
          <li class="nav-item">
            <a class="nav-link text-white" href="#" onclick="showSection('search-section')">
              Home
            </a>
          </li>
          <li class="nav-item">
            <a class="nav-link text-white" href="#" onclick="showSection('upload-section')">
              Upload
            </a>
          </li>
          <li class="nav-item">
            <a class="nav-link text-white" href="#" onclick="showSection('convert-section')">
              Img to PDF
            </a>
          </li>
          <li class="nav-item">
            <a class="nav-link text-white" href="research.html">
              Research Papers
            </a>
          </li>
          <li class="nav-item">
            <a class="nav-link text-white" href="projects.html">
              Projects
            </a>
          </li>
        </ul>
      </nav>
    </div>
  </header>
  <main class="container py-4">
    <section id="upload-section" class="mb-8" style="display: none;">
      <h2 class="h4 font-weight-bold mb-4">
        Upload Study Material
      </h2>
      <form id="uploadStudyMaterialForm" class="bg-white p-6 rounded shadow-sm" method="post"
        enctype="multipart/form-data" onsubmit="handleFormSubmit(event, 'uploadStudyMaterialForm', '/upload')">
        <div class="form-group">
          <label for="semester">
            Semester
          </label>
          <select class="form-control" id="semester" name="semester">
            <option value="1">
              Semester 1
            </option>
            <option value="2">
              Semester 2
            </option>
            <option value="3">
              Semester 3
            </option>
            <option value="4">
              Semester 4
            </option>
            <option value="5">
              Semester 5
            </option>
            <option value="6">
              Semester 6
            </option>
            <option value="7">
              Semester 7
            </option>
            <option value="8">
              Semester 8
            </option>
          </select>
        </div>
        <div class="form-group">
          <label for="regulation">
            Regulation
          </label>
          <select class="form-control" id="regulation" name="regulation">
            <option value="2021">
              2021
            </option>
            <option value="R2021">
              R2021
            </option>
          </select>
        </div>
        <div class="form-group">
          <label for="status">
            Status
          </label>
          <select class="form-control" id="status" name="status">
            <option value="public">
              Public
            </option>
            <option value="private">
              Private
            </option>
          </select>
        </div>
        <div class="form-group">
          <label for="title">
            Title
          </label>
          <input class="form-control" id="title" name="title" type="text" />
        </div>
        <div class="form-group">
          <label for="file">
            Upload File (PDF, PPT, PPTX, DOC, DOCX)
          </label>
          <input class="form-control-file" id="file" name="file" type="file" />
        </div>
        <div class="form-group">
          <label for="userId">User ID</label>
          <input class="form-control" id="userId" name="userId" type="text" required />
        </div>
        <div class="form-group">
          <label for="password">Password</label>
          <input class="form-control" id="password" name="password" type="password" required />
        </div>
        <button type="submit" class="btn btn-primary">Upload</button>
      </form>
    </section>
    <section id="search-section" class="mb-8">
      <h2 class="h4 font-weight-bold mb-4">
        Search Study Material
      </h2>
      <form id="searchStudyMaterialForm" class="bg-white p-6 rounded shadow-sm" method="get" action="/search"
        onsubmit="handleSearch(event, 'searchStudyMaterialForm', '/search')">
        <div class="form-group">
          <label for="search-semester">
            Semester
          </label>
          <select class="form-control" id="search-semester" name="semester">
            <option value="1">
              Semester 1
            </option>
            <option value="2">
              Semester 2
            </option>
            <option value="3">
              Semester 3
            </option>
            <option value="4">
              Semester 4
            </option>
            <option value="5">
              Semester 5
            </option>
            <option value="6">
              Semester 6
            </option>
            <option value="7">
              Semester 7
            </option>
            <option value="8">
              Semester 8
            </option>
          </select>
        </div>
        <div class="form-group">
          <label for="search-regulation">
            Regulation
          </label>
          <select class="form-control" id="search-regulation" name="regulation">
            <option value="2021">
              2021
            </option>
            <option value="R2021">
              R2021
            </option>
          </select>
        </div>
        <div class="form-group">
          <label for="search-status">
            Status
          </label>
          <select class="form-control" id="search-status" name="status">
            <option value="public">
              Public
            </option>
            <option value="private">
              Private
            </option>
          </select>
        </div>
        <div class="form-group">
          <label for="search-input">
            Search
          </label>
          <input class="form-control" id="search-input" name="search" type="text" />
        </div>
        <button class="btn btn-primary" type="submit">
          Search
        </button>
      </form>
      <div id="search-results" class="row">
        
      </div>
    </section>

    <section id="convert-section" class="mb-8" style="display: none;">
    <h2 class="h4 font-weight-bold mb-4">Convert Image to PDF</h2>
    <form id="convertImageForm" class="bg-white p-6 rounded shadow-sm" action="/convert" method="post"
      enctype="multipart/form-data" onsubmit="handleFormSubmit(event, 'convertImageForm', '/convert')">
      <div class="form-group">
        <label for="title">Title</label>
        <input class="form-control" id="title" name="title" type="text" placeholder="Enter Title" required />
      </div>
      <div class="form-group">
        <label for="semester">Semester</label>
        <select class="form-control" id="semester" name="semester">
          <option value="1">Semester 1</option>
          <option value="2">Semester 2</option>
          <option value="3">Semester 3</option>
          <option value="4">Semester 4</option>
          <option value="5">Semester 5</option>
          <option value="6">Semester 6</option>
          <option value="7">Semester 7</option>
          <option value="8">Semester 8</option>
        </select>
      </div>
      <div class="form-group">
        <label for="regulation">Regulation</label>
        <select class="form-control" id="regulation" name="regulation">
          <option value="2021">2021</option>
          <option value="R2021">R2021</option>
        </select>
      </div>
      <div class="form-group">
        <label for="status">Status</label>
        <div>
          <input type="radio" id="public" name="status" value="public" required />
          <label for="public">Public</label>
        </div>
        <div>
          <input type="radio" id="private" name="status" value="private" required />
          <label for="private">Private</label>
        </div>
      </div>
      <div class="form-group">
        <label for="image">Upload Images</label>
        <input class="form-control-file" id="image" name="images" type="file" multiple required />
      </div>
      <div class="form-group">
        <label for="userId">User ID</label>
        <input class="form-control" id="userId" name="userId" type="text" required />
      </div>
      <div class="form-group">
        <label for="password">Password</label>
        <input class="form-control" id="password" name="password" type="password" required />
      </div>
      <button type="submit" class="btn btn-primary">Submit</button>
    </form>
    </section>
    </main>

  <!-- Instructions Popup -->
  <div class="modal fade" id="instructionsModal" tabindex="-1" role="dialog" aria-labelledby="instructionsModalLabel" aria-hidden="true">
    <div class="modal-dialog" role="document">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title" id="instructionsModalLabel">Instructions</h5>
          <button type="button" class="close" data-dismiss="modal" aria-label="Close">
            <span aria-hidden="true">&times;</span>
          </button>
        </div>
        <div class="modal-body">
          <p>Welcome to EduShare! Here you can upload and search for study materials, projects, and research papers. Please follow the instructions below:</p>
          <ul>
            <li>To upload content, use the respective upload options in the navigation menu.</li>
            <li>Fill in all the required fields and upload your files.</li>
            <li>To search for content, use the search forms on the respective pages.</li>
            <li>You can preview and download content from the search results.</li>
          </ul>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-primary" data-dismiss="modal">Got it!</button>
        </div>
      </div>
    </div>
  </div>

  
  <div id="loginPopup" class="modal" tabindex="-1" role="dialog" style="display: none;">
    <div class="modal-dialog" role="document">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title">Unlock Private Material</h5>
          <button type="button" class="close" onclick="closeLoginPopup()" aria-label="Close">
            <span aria-hidden="true">&times;</span>
          </button>
        </div>
        <div class="modal-body">
          <form id="loginForm" onsubmit="handleUnlock(event, 'materialId')">
            <div class="form-group">
              <label for="userId">User ID</label>
              <input type="text" class="form-control" id="userId" required>
            </div>
            <div class="form-group">
              <label for="password">Password</label>
              <input type="password" class="form-control" id="password" required>
            </div>
            <button type="submit" class="btn btn-primary">Unlock</button>
          </form>
        </div>
      </div>
    </div>
  </div>

  <!-- Modal for Editing Material -->
  <div id="editMaterialModal" class="modal fade" tabindex="-1" role="dialog">
    <div class="modal-dialog" role="document">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title">Edit Material</h5>
          <button type="button" class="close" data-dismiss="modal" aria-label="Close">
            <span aria-hidden="true">&times;</span>
          </button>
        </div>
        <div class="modal-body">
          <form id="editMaterialForm" onsubmit="handleEditMaterial(event, 'editMaterialForm')">
            <input type="hidden" id="editMaterialId">
            <div class="form-group">
              <label for="editMaterialTitle">Material Title</label>
              <input type="text" class="form-control" id="editMaterialTitle" required>
            </div>
            <div class="form-group">
              <label for="editMaterialDescription">Material Description</label>
              <textarea class="form-control" id="editMaterialDescription" rows="4" required></textarea>
            </div>
            <div class="form-group">
              <label for="editMaterialSemester">Semester</label>
              <select class="form-control" id="editMaterialSemester" required>
                <option value="1">Semester 1</option>
                <option value="2">Semester 2</option>
                <option value="3">Semester 3</option>
                <option value="4">Semester 4</option>
                <option value="5">Semester 5</option>
                <option value="6">Semester 6</option>
                <option value="7">Semester 7</option>
                <option value="8">Semester 8</option>
              </select>
            </div>
            <div class="form-group">
              <label for="editMaterialRegulation">Regulation</label>
              <select class="form-control" id="editMaterialRegulation" required>
                <option value="2021">2021</option>
                <option value="R2021">R2021</option>
              </select>
            </div>
            <div class="form-group">
              <label for="editUserId">User ID</label>
              <input type="text" class="form-control" id="editUserId" required>
            </div>
            <div class="form-group">
              <label for="editPassword">Password</label>
              <input type="password" class="form-control" id="editPassword" required>
            </div>
            <button type="submit" class="btn btn-primary">Save Changes</button>
          </form>
        </div>
      </div>
    </div>
  </div>

  <script>
    // Show instructions modal on first entry
    // document.addEventListener('DOMContentLoaded', function() {
    //   if (!localStorage.getItem('instructionsShown')) {
    //     $('#instructionsModal').modal('show');
    //     localStorage.setItem('instructionsShown', 'true');
    //   }

    //   fetch('/get-study-materials')
    //     .then(response => response.json())
    //     .then(data => {
    //       if (data && data.materials && data.materials.length) {
    //         data.materials.forEach(material => {
    //           // Your existing code to handle each material
    //         });
    //       } else {
    //         console.error('No study materials found');
    //       }
    //     })
    //     .catch(error => {
    //       console.error('Error fetching study materials:', error);
    //     });
    // });

    function closeLoginPopup() {
      $('#loginPopup').modal('hide');
    }

    function showUnlockPopup(materialId) {
      $('#loginPopup').modal('show');
      document.getElementById('loginForm').onsubmit = function(event) {
        handleUnlock(event, materialId);
      };
    }

    function handleUnlock(event, materialId) {
      event.preventDefault();
      const userId = document.getElementById('userId').value;
      const password = document.getElementById('password').value;

      fetch('/verify-user', {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json'
        },
        body: JSON.stringify({ userId, password })
      })
      .then(response => response.json())
      .then(data => {
        if (data.message === 'User verified successfully') {
          // Unlock the material
          document.querySelector(`#material-${materialId} .overlay`).style.display = 'none';
          $('#loginPopup').modal('hide');
        } else {
          alert('Invalid UserId or Password');
        }
      })
      .catch(error => {
        console.error('Error:', error);
        alert('An error occurred while verifying the user.');
      });
    }

    function showEditPopup(materialId) {
      const userId = prompt('Enter your User ID:');
      const password = prompt('Enter your Password:');

      fetch('/verify-user', {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json'
        },
        body: JSON.stringify({ userId, password })
      })
      .then(response => response.json())
      .then(data => {
        if (data.message === 'User verified successfully') {
          const confirmation = confirm('Are you sure you want to edit this material?');
          if (confirmation) {
            // Show edit form
            const material = document.getElementById(`material-${materialId}`);
            const title = material.querySelector('.card-title').innerText;
            const description = material.querySelector('.card-text').innerText;
            const semester = material.querySelector('.card-semester').innerText;
            const regulation = material.querySelector('.card-regulation').innerText;

            document.getElementById('editMaterialId').value = materialId;
            document.getElementById('editMaterialTitle').value = title;
            document.getElementById('editMaterialDescription').value = description;
            document.getElementById('editMaterialSemester').value = semester;
            document.getElementById('editMaterialRegulation').value = regulation;
            $('#editMaterialModal').modal('show');
          }
        } else {
          alert('Invalid UserId or Password');
        }
      })
      .catch(error => {
        console.error('Error:', error);
        alert('An error occurred while verifying the user.');
      });
    }

    function handleEditMaterial(event) {
      event.preventDefault();
      const materialId = document.getElementById('editMaterialId').value;
      const materialTitle = document.getElementById('editMaterialTitle').value;
      const materialDescription = document.getElementById('editMaterialDescription').value;
      const materialSemester = document.getElementById('editMaterialSemester').value;
      const materialRegulation = document.getElementById('editMaterialRegulation').value;
      const userId = document.getElementById('editUserId').value;
      const password = document.getElementById('editPassword').value;

      fetch('/edit-material', {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json'
        },
        body: JSON.stringify({ materialId, materialTitle, materialDescription, materialSemester, materialRegulation, userId, password })
      })
      .then(response => response.json())
      .then(data => {
        if (data.message === 'Material updated successfully') {
          alert('Material updated successfully');
          $('#editMaterialModal').modal('hide');
          location.reload();
        } else {
          alert(data.message);
        }
      })
      .catch(error => {
        console.error('Error:', error);
        alert('An error occurred while updating the material.');
      });
    }
  </script>

  <script src="scripts.js"></script>
</body>

</html>